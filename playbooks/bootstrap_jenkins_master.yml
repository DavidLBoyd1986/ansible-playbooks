---
- name: Bootstrap a server to be a Jenkins Master Server
  hosts: jenkins_master
  tasks:
  - name: Install Java and other packages
    yum:
      name:
        - java-17-openjdk
        - fontconfig
      state: present

  - name: Install Jenkins Repository
    yum_repository:
      name: Jenkins-stable
      description: Jenkins Repository
      baseurl: http://pkg.jenkins.io/redhat-stable/
      gpgcheck: true
      gpgkey: https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key

  - name: Add Jenkins gpg key to rpm database
    rpm_key:
      key: https://pkg.jenkins.io/redhat-stable/jenkins.io-2023.key
      state: present

  - name: Install Jenkins
    yum:
      name: jenkins
      state: present

  - name: Reload daemons
    command: systemctl daemon-reload

  - name: Start Jenkins
    service:
      name: jenkins
      state: started
      enabled: yes

  - name: Open port 8080 in firewall
    firewalld:
      zone: public
      service: http
      port: 8080/tcp
      state: enabled
      permanent: true
      immediate: true

  - name: Check that jenkins page is reachable
    uri:
      url: http://localhost:8080
      status_code: 200

  # Add in adding a cert using let's encrypt

  # configure DNS for Jenkins